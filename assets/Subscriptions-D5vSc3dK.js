import{j as e}from"./ui-DjmETXT1.js";import{r as g,u as x,q as h,M as p,S as N,g as t,t as v,v as _,w as u,x as a,y as b,z as r,f as l,A as M}from"./index-D5z5fl22.js";import{N as w}from"./vendor-C3n1ReTT.js";import"./supabase-xng3xIeN.js";import"./charts-CVdhJMV6.js";function L(){const{user:i}=g(),{data:c,isLoading:j}=x({queryKey:["is-admin",i==null?void 0:i.id],queryFn:async()=>{if(!i)return!1;const{data:s}=await h.from("user_roles").select("role").eq("user_id",i.id).eq("role","admin").single();return!!s},enabled:!!i}),{data:d,isLoading:y}=x({queryKey:["all-subscriptions"],queryFn:async()=>{const{data:s}=await h.from("company_subscriptions").select("*, companies(name, email), subscription_plans(name, price_bdt, price_usd)").order("created_at",{ascending:!1});return s||[]},enabled:c===!0});if(j)return e.jsx(p,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})})});if(!c)return e.jsx(w,{to:"/dashboard",replace:!0});const f=s=>{const n={active:"default",trial:"secondary",expired:"destructive",cancelled:"outline"};return e.jsx(M,{variant:n[s]||"outline",children:s==null?void 0:s.toUpperCase()})};return e.jsx(p,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Subscription Management"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage all customer subscriptions"})]})]}),y?e.jsx(t,{className:"p-6 animate-pulse",children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-12 bg-muted rounded"},s))})}):!d||d.length===0?e.jsx(t,{className:"p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No subscriptions found"}),e.jsx("p",{className:"text-muted-foreground",children:"Subscriptions will appear here as users sign up"})]})}):e.jsx(t,{children:e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(u,{children:[e.jsx(a,{children:"Company"}),e.jsx(a,{children:"Plan"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Amount Paid"}),e.jsx(a,{children:"Created"}),e.jsx(a,{children:"Trial Ends"}),e.jsx(a,{children:"Period End"})]})}),e.jsx(b,{children:d.map(s=>{var n,o,m;return e.jsxs(u,{children:[e.jsx(r,{className:"font-medium",children:e.jsxs("div",{children:[e.jsx("div",{children:(n=s.companies)==null?void 0:n.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(o=s.companies)==null?void 0:o.email})]})}),e.jsx(r,{children:(m=s.subscription_plans)==null?void 0:m.name}),e.jsx(r,{children:f(s.status)}),e.jsx(r,{children:s.amount_paid?`${s.currency==="BDT"?"à§³":"$"}${s.amount_paid}`:"-"}),e.jsx(r,{children:l(new Date(s.created_at),"dd MMM yyyy")}),e.jsx(r,{children:s.trial_ends_at?l(new Date(s.trial_ends_at),"dd MMM yyyy"):"-"}),e.jsx(r,{children:s.current_period_end?l(new Date(s.current_period_end),"dd MMM yyyy"):"-"})]},s.id)})})]})})]})})}export{L as default};
