import{j as e}from"./ui-DjmETXT1.js";import{r as o,N as b}from"./vendor-C3n1ReTT.js";import{r as v,u as R,q as p,M as x,a8 as w,$ as j,g as C,R as S,Y as q,a9 as F,V as L,L as f,I as g,B as k,J as t}from"./index-D5z5fl22.js";import"./supabase-xng3xIeN.js";import"./charts-CVdhJMV6.js";const B=()=>{const{user:r}=v(),[n,l]=o.useState(""),[i,d]=o.useState(""),[c,u]=o.useState(!1),{data:y,isLoading:N}=R({queryKey:["is-super-admin",r==null?void 0:r.id],queryFn:async()=>{if(!r)return!1;const{data:s}=await p.from("user_roles").select("role").eq("user_id",r.id).eq("role","super_admin").single();return!!s},enabled:!!r}),P=async s=>{if(s.preventDefault(),!n||!i){t.error("Please fill in all fields");return}if(i.length<8){t.error("Password must be at least 8 characters long");return}u(!0);try{const{data:{session:a}}=await p.auth.getSession();if(!(a!=null&&a.access_token)){t.error("Not authenticated");return}const m=await fetch("https://krphkpliaoitytorrpcv.supabase.co/functions/v1/admin-reset-password",{method:"POST",headers:{Authorization:`Bearer ${a.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({email:n,newPassword:i})}),h=await m.json();if(!m.ok)throw new Error(h.error||"Failed to reset password");t.success(h.message||"Password reset successfully"),l(""),d("")}catch(a){console.error("Password reset error:",a),t.error(a.message||"Failed to reset password")}finally{u(!1)}};return N?e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(w,{className:"h-8 w-8 animate-spin"})})}):y?e.jsx(x,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(j,{className:"h-8 w-8"}),"User Password Reset"]}),e.jsx("p",{className:"text-muted-foreground",children:"Reset passwords for any user account (Super Admin only)"})]}),e.jsxs(C,{className:"max-w-2xl",children:[e.jsxs(S,{children:[e.jsx(q,{children:"Reset User Password"}),e.jsx(F,{children:"Enter the user's email and their new password. This action will be logged in the audit trail."})]}),e.jsx(L,{children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",children:"User Email"}),e.jsx(g,{id:"email",type:"email",placeholder:"user@example.com",value:n,onChange:s=>l(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"newPassword",children:"New Password"}),e.jsx(g,{id:"newPassword",type:"password",placeholder:"Minimum 8 characters",value:i,onChange:s=>d(s.target.value),minLength:8,required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Password must be at least 8 characters long"})]}),e.jsx(k,{type:"submit",disabled:c,className:"w-full",children:c?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Resetting Password..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"Reset Password"]})})]})})]})]})}):e.jsx(b,{to:"/dashboard",replace:!0})};export{B as default};
