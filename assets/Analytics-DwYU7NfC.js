import{j as e}from"./ui-DjmETXT1.js";import{u as x,M as I,a2 as K,g as d,R as l,Y as i,U as B,V as c,a3 as F,X as L,_ as Q,a4 as R,q as m}from"./index-D5z5fl22.js";import{R as j,B as p,C as f,X as g,Y as y,T as N,L as b,a as v}from"./charts-CVdhJMV6.js";import"./vendor-C3n1ReTT.js";import"./supabase-xng3xIeN.js";const O=()=>{const{data:t}=x({queryKey:["admin-ai-usage"],queryFn:async()=>{const{data:s}=await m.from("ai_usage").select("usage_type, tokens_used, cost_bdt, created_at").order("created_at",{ascending:!1}).limit(100);return s||[]}}),{data:a}=x({queryKey:["admin-subscription-stats"],queryFn:async()=>{const{data:s}=await m.from("company_subscriptions").select(`
          status,
          created_at,
          subscription_plans(name)
        `).order("created_at",{ascending:!1});return s||[]}}),{data:o}=x({queryKey:["admin-user-growth"],queryFn:async()=>{const{data:s}=await m.from("profiles").select("created_at").order("created_at",{ascending:!0});return s||[]}}),w=t==null?void 0:t.reduce((s,n)=>{const r=n.usage_type;return s[r]||(s[r]={type:r,tokens:0,cost:0,count:0}),s[r].tokens+=n.tokens_used||0,s[r].cost+=n.cost_bdt||0,s[r].count+=1,s},{}),_=Object.values(w||{}),C=a==null?void 0:a.reduce((s,n)=>{var h;const r=((h=n.subscription_plans)==null?void 0:h.name)||"Unknown";return s[r]||(s[r]={plan:r,count:0}),s[r].count+=1,s},{}),k=Object.values(C||{}),u=(t==null?void 0:t.reduce((s,n)=>s+(n.tokens_used||0),0))||0,A=(t==null?void 0:t.reduce((s,n)=>s+(n.cost_bdt||0),0))||0,T=(a==null?void 0:a.filter(s=>s.status==="active").length)||0,q=(a==null?void 0:a.filter(s=>s.status==="trial").length)||0;return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(K,{className:"h-8 w-8"}),"Platform Analytics"]}),e.jsx("p",{className:"text-muted-foreground",children:"Platform-wide usage statistics and trends"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Total Users"}),e.jsx(B,{className:"h-5 w-5 text-blue-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(o==null?void 0:o.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Registered accounts"})]})]}),e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"AI Tokens Used"}),e.jsx(F,{className:"h-5 w-5 text-purple-500"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total tokens consumed"})]})]}),e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"AI Cost"}),e.jsx(L,{className:"h-5 w-5 text-green-500"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["à§³",A.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total AI spending"})]})]}),e.jsxs(d,{children:[e.jsxs(l,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(i,{className:"text-sm font-medium text-muted-foreground",children:"Active Subs"}),e.jsx(Q,{className:"h-5 w-5 text-primary"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:T}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[q," on trial"]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(d,{children:[e.jsx(l,{children:e.jsx(i,{children:"AI Usage by Type"})}),e.jsx(c,{children:e.jsx(j,{width:"100%",height:300,children:e.jsxs(p,{data:_,children:[e.jsx(f,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"type"}),e.jsx(y,{}),e.jsx(N,{}),e.jsx(b,{}),e.jsx(v,{dataKey:"count",fill:"hsl(var(--primary))",name:"Query Count"})]})})})]}),e.jsxs(d,{children:[e.jsx(l,{children:e.jsx(i,{children:"Subscriptions by Plan"})}),e.jsx(c,{children:e.jsx(j,{width:"100%",height:300,children:e.jsxs(p,{data:k,children:[e.jsx(f,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"plan"}),e.jsx(y,{}),e.jsx(N,{}),e.jsx(b,{}),e.jsx(v,{dataKey:"count",fill:"hsl(var(--primary))",name:"Subscribers"})]})})})]})]}),e.jsxs(d,{children:[e.jsx(l,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Quick Stats"]})}),e.jsx(c,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"AI Queries (Last 100)"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:(t==null?void 0:t.length)||0})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Tokens per Query"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:t&&t.length>0?Math.round(u/t.length):0})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Subscriptions"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:(a==null?void 0:a.length)||0})]})]})})]})]})})};export{O as default};
