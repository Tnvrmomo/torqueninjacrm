import{j as e}from"./ui-DjmETXT1.js";import{Q as w,u as N,M as _,$ as b,g as A,R as K,Y as C,V as P,t as T,v as I,w as x,x as a,y as M,z as t,B as m,a0 as S,A as d,Z as h,a1 as k,q as u,J as j}from"./index-D5z5fl22.js";import{r as E}from"./vendor-C3n1ReTT.js";import"./supabase-xng3xIeN.js";import"./charts-CVdhJMV6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=w("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),D=()=>{const[c,p]=E.useState(new Set),{data:n,isLoading:f,refetch:v}=N({queryKey:["admin-api-keys"],queryFn:async()=>{const{data:s}=await u.from("api_keys").select(`
          id,
          name,
          key_preview,
          permissions,
          is_active,
          created_at,
          last_used_at,
          expires_at,
          company_id,
          companies(name)
        `).order("created_at",{ascending:!1});return s||[]}}),y=async s=>{if(!confirm("Are you sure you want to revoke this API key? This action cannot be undone."))return;const{error:i}=await u.from("api_keys").update({is_active:!1}).eq("id",s);i?(j.error("Failed to revoke API key"),console.error(i)):(j.success("API key revoked successfully"),v())},g=s=>{p(i=>{const r=new Set(i);return r.has(s)?r.delete(s):r.add(s),r})};return e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2",children:[e.jsx(b,{className:"h-8 w-8"}),"API Keys Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage all API keys across all companies"})]}),e.jsxs(A,{children:[e.jsx(K,{children:e.jsx(C,{children:"All API Keys"})}),e.jsx(P,{children:f?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"},s))}):n&&n.length>0?e.jsxs(T,{children:[e.jsx(I,{children:e.jsxs(x,{children:[e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Company"}),e.jsx(a,{children:"Key Preview"}),e.jsx(a,{children:"Permissions"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Last Used"}),e.jsx(a,{children:"Created"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(M,{children:n.map(s=>{var i,r,l;return e.jsxs(x,{children:[e.jsx(t,{className:"font-medium",children:s.name}),e.jsx(t,{children:((i=s.companies)==null?void 0:i.name)||"Unknown"}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:c.has(s.id)?s.key_preview:"••••••••"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>g(s.id),children:c.has(s.id)?e.jsx(R,{className:"h-4 w-4"}):e.jsx(S,{className:"h-4 w-4"})})]})}),e.jsx(t,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(r=s.permissions)==null?void 0:r.slice(0,2).map(o=>e.jsx(d,{variant:"secondary",className:"text-xs",children:o},o)),((l=s.permissions)==null?void 0:l.length)>2&&e.jsxs(d,{variant:"outline",className:"text-xs",children:["+",s.permissions.length-2," more"]})]})}),e.jsx(t,{children:e.jsx(d,{variant:s.is_active?"default":"destructive",children:s.is_active?"Active":"Revoked"})}),e.jsx(t,{className:"text-sm text-muted-foreground",children:s.last_used_at?h(new Date(s.last_used_at),{addSuffix:!0}):"Never"}),e.jsx(t,{className:"text-sm text-muted-foreground",children:h(new Date(s.created_at),{addSuffix:!0})}),e.jsx(t,{children:s.is_active&&e.jsx(m,{variant:"destructive",size:"sm",onClick:()=>y(s.id),children:e.jsx(k,{className:"h-4 w-4"})})})]},s.id)})})]}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No API keys found"})})]})]})})};export{D as default};
