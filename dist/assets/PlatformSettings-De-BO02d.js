import{j as e}from"./ui-DjmETXT1.js";import{r as E,E as Q,u as S,q as c,F as W,M as b,G,T as H,h as J,i as V,H as O,j as U,g as l,L as a,I as t,B as d,J as X}from"./index-D5z5fl22.js";import{r,N as Y}from"./vendor-C3n1ReTT.js";import"./supabase-xng3xIeN.js";import"./charts-CVdhJMV6.js";function te(){const{user:n}=E(),f=Q(),[o,_]=r.useState(""),[h,N]=r.useState(""),[m,w]=r.useState(""),[u,C]=r.useState(""),[p,K]=r.useState(""),[x,F]=r.useState(""),[g,I]=r.useState(""),[y,q]=r.useState(""),[j,L]=r.useState(""),[v,M]=r.useState(""),{data:k,isLoading:B}=S({queryKey:["is-super-admin",n==null?void 0:n.id],queryFn:async()=>{if(!n)return!1;const{data:s}=await c.from("user_roles").select("role").eq("user_id",n.id).eq("role","super_admin").single();return!!s},enabled:!!n});S({queryKey:["platform-settings"],queryFn:async()=>{const{data:s}=await c.from("platform_settings").select("*");return s||[]},enabled:k===!0});const i=W({mutationFn:async({key:s,value:D})=>{await c.from("platform_settings").update({setting_value:D,updated_by:n.id}).eq("setting_key",s),await c.from("admin_audit_log").insert({admin_user_id:n.id,action:"update_platform_setting",target_entity_type:"setting",details:{setting_key:s}})},onSuccess:()=>{f.invalidateQueries({queryKey:["platform-settings"]}),X.success("Settings updated successfully")}}),P=()=>{i.mutate({key:"stripe_secret_key",value:{key:o,webhook_secret:h}})},R=()=>{i.mutate({key:"sslcommerz_credentials",value:{store_id:m,store_password:u}})},T=()=>{i.mutate({key:"bkash_credentials",value:{app_key:p,app_secret:x}})},A=()=>{i.mutate({key:"nagad_credentials",value:{merchant_id:g,merchant_key:y}})},z=()=>{i.mutate({key:"rocket_credentials",value:{merchant_id:j,merchant_key:v}})};return B?e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})})}):k?e.jsx(b,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Platform Settings"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure global platform settings and API keys"})]})]}),e.jsxs(H,{defaultValue:"payments",className:"space-y-4",children:[e.jsx(J,{children:e.jsxs(V,{value:"payments",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Payment Gateways"]})}),e.jsxs(U,{value:"payments",className:"space-y-4",children:[e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Stripe (International)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"stripe-key",children:"Secret Key"}),e.jsx(t,{id:"stripe-key",type:"password",value:o,onChange:s=>_(s.target.value),placeholder:"sk_live_..."})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"stripe-webhook",children:"Webhook Secret"}),e.jsx(t,{id:"stripe-webhook",type:"password",value:h,onChange:s=>N(s.target.value),placeholder:"whsec_..."})]}),e.jsx(d,{onClick:P,children:"Save Stripe Settings"})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"SSLCommerz (Bangladesh)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"ssl-id",children:"Store ID"}),e.jsx(t,{id:"ssl-id",value:m,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"ssl-password",children:"Store Password"}),e.jsx(t,{id:"ssl-password",type:"password",value:u,onChange:s=>C(s.target.value)})]}),e.jsx(d,{onClick:R,children:"Save SSLCommerz Settings"})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"bKash (Bangladesh Mobile)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"bkash-key",children:"App Key"}),e.jsx(t,{id:"bkash-key",value:p,onChange:s=>K(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"bkash-secret",children:"App Secret"}),e.jsx(t,{id:"bkash-secret",type:"password",value:x,onChange:s=>F(s.target.value)})]}),e.jsx(d,{onClick:T,children:"Save bKash Settings"})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Nagad (Bangladesh Mobile)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"nagad-id",children:"Merchant ID"}),e.jsx(t,{id:"nagad-id",value:g,onChange:s=>I(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"nagad-key",children:"Merchant Key"}),e.jsx(t,{id:"nagad-key",type:"password",value:y,onChange:s=>q(s.target.value)})]}),e.jsx(d,{onClick:A,children:"Save Nagad Settings"})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Rocket (Bangladesh Mobile)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"rocket-id",children:"Merchant ID"}),e.jsx(t,{id:"rocket-id",value:j,onChange:s=>L(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"rocket-key",children:"Merchant Key"}),e.jsx(t,{id:"rocket-key",type:"password",value:v,onChange:s=>M(s.target.value)})]}),e.jsx(d,{onClick:z,children:"Save Rocket Settings"})]})]})]})]})]})}):e.jsx(Y,{to:"/dashboard",replace:!0})}export{te as default};
